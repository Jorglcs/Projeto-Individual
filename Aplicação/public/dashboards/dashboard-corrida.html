<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hades-endgame</title>
    <!-- <link rel="icon" href="../assets/images/icon 1." /> -->
    <link rel="stylesheet" href="../styles/dashboard-corrida.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <!-- <body onload="obterDados()"></body> -->

  <body
    onload="buscarAtaquesBasicos(),buscarAndarAlcancado(),buscarAtaquesEspeciais(),buscarAtaquesCriticos(),buscarInimigosDerrotados(),buscarGraficoDano()"
  >
    <div class="left-bar">
      <img src="../assets/images/hades-logo-branca.png" alt="" />
      <div>
        <a href=""
          >Relatório da ultima corrida <i class="fas fa-file-lines"></i
        ></a>
        <a href="">Perfil <i class="fas fa-user"></i></a>
        <a href="">Ranking <i class="fas fa-trophy"></i></a>
      </div>
      <button>Jogar novamente <i class="fas fa-rotate-right"></i></button>
      <button>Sair <i class="fas fa-door-open"></i></button>
    </div>
    <div class="container">
      <div class="container-top">
        <div>
          <h1>Relatório de fim de jogo:</h1>
          <h2 id="h2_andarAlcancado">Andar alcançado:0</h2>
        </div>
        <div class="profile">
          <h1 id="h1_nickname">nickname</h1>
          <img src="../assets/images/profile-icon.png" alt="" />
        </div>
      </div>
      <div class="kpis">
        <div class="kpi">
          <h2>Ataques básicos:</h2>
          <div>
            <h1 id="h1_ataquesBasicos">0</h1>
            <i class="fas fa-hand-fist"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques especiais:</h2>
          <div>
            <h1 id="h1_ataquesEspeciais">0</h1>
            <i class="fas fa-burst"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques críticos:</h2>
          <div>
            <h1 id="h1_ataquesCriticos">0</h1>
            <i class="fas fa-bolt"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Inimigos derrotados:</h2>
          <div>
            <h1 id="h1_inimigosDerrotados">0</h1>
            <i class="fas fa-skull"></i>
          </div>
        </div>
      </div>
      <div class="graficos">
        <div class="graifico-pie">
          <h1>Bençãos selecionadas:</h1>
          
          <canvas id="pie"></canvas>
        </div>
        <div>
          <h1>Dano causado e recebido:</h1>
          <canvas id="barra"></canvas>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  h1_nickname.innerHTML = `${sessionStorage.NICKNAME}`;
  function buscarAtaquesBasicos() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesBasicos/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesBasicos.innerHTML = `${resposta[0].totalAtaquesBasicos}`;
        });
      }
    });
  }
  function buscarAndarAlcancado() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAndarAlcancado/${idUsuario}`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            h2_andarAlcancado.innerHTML = `Andar alcançado:${resposta[0].andarAlcancado}`;
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }
  function buscarAtaquesEspeciais() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesEspeciais/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesEspeciais.innerHTML = `${resposta[0].totalAtaquesEspeciais}`;
        });
      }
    });
  }

  function buscarInimigosDerrotados() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarInimigosDerrotados/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_inimigosDerrotados.innerHTML = `${resposta[0].inimigosDerrotados}`;
        });
      }
    });
  }

  function buscarAtaquesCriticos() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesCriticos/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesCriticos.innerHTML = `${resposta[0].totalAtaquesCriticos}`;
        });
      }
    });
  }


  // buscar o grafico de dano

  var dadoDano = []
   function buscarGraficoDano() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarGraficoDano/${idUsuario}`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            dadoDano.push(resposta[0].danoCausado);
            dadoDano.push(resposta[0].danoRecebido);
             plotarGraficoBarra(dadoDano)
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }
  console.log(dadoDano)
  const ctx = document.getElementById("pie");

  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
      datasets: [
        {
          label: "# of Votes",
          data: [12, 19, 3, 5, 2, 3],
          borderWidth: 1,
        },
      ],
    },
    options: {
      maintainAspectRatio: false,

      plugins: {
        legend: {
          position: "bottom",
        },
        scales: {
          y: {
            display: false,
          },
        },
      },
    },
  });
  function plotarGraficoBarra(data){
  const ctx2 = document.getElementById("barra");
  new Chart(ctx2, {
    type: "bar",

    data: {
      labels: ["Dano causado", "Dano recebido"],
      datasets: [
        {
          label: "Dano",
          data: data,
          borderWidth: 1,
        },
      ],
    },
    options: {
      maintainAspectRatio: false,

      plugins: {
        legend: {
          position: "bottom",
        },
        title: {
          display: false,
          text: "Dano causado e recebido",
          color: "white",
          font: {
            size: 18,
          },
        },
      },
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
  }
</script>
