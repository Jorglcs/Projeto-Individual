<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hades-endgame</title>
    <!-- <link rel="icon" href="../assets/images/icon 1." /> -->
    <link rel="stylesheet" href="../styles/dashboard-corrida.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <!-- <body onload="obterDados()"></body> -->

  <body
    onload="buscarAtaquesBasicos(),buscarAndarAlcancado(),buscarAtaquesEspeciais(),buscarAtaquesCriticos(),buscarInimigosDerrotados(),buscarGraficoDano(),buscarGraficoPortas()"
  >
    <div class="left-bar">
      <img src="../assets/images/hades-logo-branca.png" alt="" />
      <div>
        <a href=""
          >Relatório da ultima corrida <i class="fas fa-file-lines"></i
        ></a>
        <a href="dashboard-perfil.html">Perfil <i class="fas fa-user"></i></a>
        <a href="dashboard-ranking.html"
          >Ranking <i class="fas fa-trophy"></i
        ></a>
      </div>
      <button onclick="jogarNovamente()">
        Jogar novamente <i class="fas fa-rotate-right"></i>
      </button>
      <button onclick="sair()">Sair <i class="fas fa-door-open"></i></button>
    </div>
    <div class="container">
      <div class="container-top">
        <div>
          <h1>Relatório da ultima corrida:</h1>
          <h2 id="h2_andarAlcancado">Andar alcançado:0</h2>
        </div>
        <div class="profile">
          <h1 id="h1_nickname">nickname</h1>
          <img src="../assets/images/profile-icon.png" alt="" />
        </div>
      </div>
      <div class="kpis">
        <div class="kpi">
          <h2>Ataques básicos:</h2>
          <div>
            <h1 id="h1_ataquesBasicos">0</h1>
            <i class="fas fa-hand-fist"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques especiais:</h2>
          <div>
            <h1 id="h1_ataquesEspeciais">0</h1>
            <i class="fas fa-burst"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques críticos:</h2>
          <div>
            <h1 id="h1_ataquesCriticos">0</h1>
            <i class="fas fa-bolt"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Inimigos derrotados:</h2>
          <div>
            <h1 id="h1_inimigosDerrotados">0</h1>
            <i class="fas fa-skull"></i>
          </div>
        </div>
      </div>
      <div class="graficos">
        <div class="graifico-pie">
          <h1>Portas selecionadas:</h1>

          <canvas id="pie"></canvas>
        </div>
        <div>
          <h1>Dano causado e recebido:</h1>
          <canvas id="barra"></canvas>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  h1_nickname.innerHTML = `${sessionStorage.NICKNAME}`;
  function buscarAtaquesBasicos() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesBasicos/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesBasicos.innerHTML = `${resposta[0].totalAtaquesBasicos}`;
        });
      }
    });
  }
  function buscarAndarAlcancado() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAndarAlcancado/${idUsuario}`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            h2_andarAlcancado.innerHTML = `Andar alcançado:${resposta[0].andarAlcancado}`;
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }
  function buscarAtaquesEspeciais() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesEspeciais/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesEspeciais.innerHTML = `${resposta[0].totalAtaquesEspeciais}`;
        });
      }
    });
  }

  function buscarInimigosDerrotados() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarInimigosDerrotados/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_inimigosDerrotados.innerHTML = `${resposta[0].inimigosDerrotados}`;
        });
      }
    });
  }

  function buscarAtaquesCriticos() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarAtaquesCriticos/${idUsuario}`).then(function (
      response
    ) {
      if (response.ok) {
        response.json().then(function (resposta) {
          h1_ataquesCriticos.innerHTML = `${resposta[0].totalAtaquesCriticos}`;
        });
      }
    });
  }

  // buscar o grafico de dano
  // plotarGraficoBarra()
  var dadoDano = [];

  function buscarGraficoDano() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarGraficoDano/${idUsuario}`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            dadoDano.push(resposta[0].danoCausado);
            dadoDano.push(resposta[0].danoRecebido);
            plotarGraficoBarra(dadoDano);
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }

  // buscar graficos portas
  var dadoPortas = [];
  function buscarGraficoPortas() {
    var idUsuario = sessionStorage.ID_USUARIO;
    fetch(`/relatorio/buscarGraficoPortas/${idUsuario}`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(resposta);
            dadoPortas.push(resposta[0].BencaoDeAres);
            dadoPortas.push(resposta[0].BencaoDeZeus);
            dadoPortas.push(resposta[0].BencaoDePoseidon);
            dadoPortas.push(resposta[0].FonteDeCura);
            dadoPortas.push(resposta[0].CoracaoDeCentauro);
            plotarGraficoPizza(dadoPortas);
            console.log(dadoPortas);
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }

  function plotarGraficoPizza(data) {
    const ctx = document.getElementById("pie");

    new Chart(ctx, {
      type: "pie",
      data: {
        labels: [
          "Benção de Ares",
          "Benção de Zeus",
          "Benção de Poseidon",
          "Fonte de cura",
          "Coração de Centauro",
        ],
        datasets: [
          {
            label: "Quantidade escolhida",
            data: data,

            backgroundColor: [
              "rgba(255, 30, 30, 0.45)",
              "rgba(255, 214, 0, 0.45)",
              "rgba(0, 120, 255, 0.45)",
              "rgba(0, 200, 80, 0.45)",
              "rgba(0, 0, 0, 0.55)",
            ],

            borderColor: [
              "rgb(150, 0, 0)",
              "rgb(140, 120, 0)",
              "rgb(0, 60, 120)",
              "rgb(0, 90, 30)",
              "rgb(20, 20, 20)",
            ],

            borderWidth: 3,
            hoverOffset: 15,
          },
        ],
      },

      options: {
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              color: "black",

              generateLabels(chart) {
                const original =
                  Chart.overrides.pie.plugins.legend.labels.generateLabels;
                const labels = original(chart);

                labels.forEach((label) => {
                  label.strokeStyle = label.fillStyle.replace("0.45", "1");
                  label.lineWidth = 3;
                });

                return labels;
              },
            },
          },
        },
      },
    });
  }

  function plotarGraficoBarra(data) {
    const ctx2 = document.getElementById("barra");

    new Chart(ctx2, {
      type: "bar",

      data: {
        labels: ["Dano causado", "Dano recebido"],
        datasets: [
          {
            label: "Dano",
            data: data,
            backgroundColor: [
              "rgba(76, 175, 80, 0.4)",
              "rgba(244, 67, 54, 0.4)",
            ],
            borderColor: ["rgba(76, 175, 80, 1)", "rgba(244, 67, 54, 1)"],
            borderWidth: 2,
            borderRadius: 10,
          },
        ],
      },

      options: {
        maintainAspectRatio: false,

        plugins: {
          legend: {
            display: true,
            position: "bottom",
            labels: {
              generateLabels(chart) {
                return [
                  {
                    text: "Dano causado",
                    fillStyle: "rgba(76, 175, 80, 0.4)",
                    strokeStyle: "rgba(76, 175, 80, 1)",
                    lineWidth: 2,
                  },
                  {
                    text: "Dano recebido",
                    fillStyle: "rgba(244, 67, 54, 0.4)",
                    strokeStyle: "rgba(244, 67, 54, 1)",
                    lineWidth: 2,
                  },
                ];
              },
              color: "white",
              font: { size: 14 },
            },
          },
        },

        scales: {
          y: { beginAtZero: true },
        },
      },
    });
  }
  function jogarNovamente() {
    window.location = "../game.html";
  }
  function sair() {
    window.location = "../menu.html";
  }
</script>
