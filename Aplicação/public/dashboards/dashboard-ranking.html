<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hades-endgame</title>
    <!-- <link rel="icon" href="../assets/images/icon 1." /> -->
    <link rel="stylesheet" href="../styles/dashboard-ranking.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <!-- <body onload="obterDados()"></body> -->

  <body onload="buscarGraficoTentativas(),buscarGraficoAndar()">
    <div class="left-bar">
      <img src="../assets/images/hades-logo-branca.png" alt="" />
      <div>
        <a href="dashboard-corrida.html"
          >Relatório da ultima corrida <i class="fas fa-file-lines"></i
        ></a>
        <a href="dashboard-perfil.html">Perfil <i class="fas fa-user"></i></a>
        <a href="">Ranking <i class="fas fa-trophy"></i></a>
      </div>
      <button onclick="jogarNovamente()">
        Jogar novamente <i class="fas fa-rotate-right"></i>
      </button>
      <button onclick="sair()">Sair <i class="fas fa-door-open"></i></button>
    </div>
    <div class="container">
      <div class="container-top">
        <div>
          <h1>Página de Ranking:</h1>
        </div>
        <div class="profile">
          <h1 id="h1_nickname">nickname</h1>
          <img src="../assets/images/profile-icon.png" alt="" />
        </div>
      </div>
      <!-- <div class="kpis">
        <div class="kpi">
          <h2>Ataques básicos:</h2>
          <div>
            <h1 id="h1_ataquesBasicos">0</h1>
            <i class="fas fa-hand-fist"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques especiais:</h2>
          <div>
            <h1 id="h1_ataquesEspeciais">0</h1>
            <i class="fas fa-burst"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Ataques críticos:</h2>
          <div>
            <h1 id="h1_ataquesCriticos">0</h1>
            <i class="fas fa-bolt"></i>
          </div>
        </div>
        <div class="kpi">
          <h2>Inimigos derrotados:</h2>
          <div>
            <h1 id="h1_inimigosDerrotados">0</h1>
            <i class="fas fa-skull"></i>
          </div>
        </div>
      </div> -->
      <div class="graficos">
        <div class="graifico-pie">
          <h1>Top jogadores com mais tentativas:</h1>

          <canvas id="tentativas"></canvas>
        </div>
        <div>
          <h1>Top corridas com maior andar:</h1>
          <canvas id="maiorAndar"></canvas>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  h1_nickname.innerHTML = `${sessionStorage.NICKNAME}`;

  // buscar graficos quantidade de tentativas
  var dadoRanking = [];
  var nomeRanking = [];
  function buscarGraficoTentativas() {
    fetch(`/ranking/rankingTentativas`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(resposta);
            for (var i = 0; i < resposta.length; i++) {
              nomeRanking.push(resposta[i].nome);
              dadoRanking.push(resposta[i].quantidadeTentativa);
            }
            plotarGraficoTentativas(dadoRanking, nomeRanking);
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }

  function plotarGraficoTentativas(data, nomes) {
    const ctx = document.getElementById("tentativas");

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: nomes,
        datasets: [
          {
            label: "Quantidade de tentativas",
            data: data,
            backgroundColor: "rgba(255, 80, 80, 0.6)",
            borderColor: "rgba(255, 50, 50, 1)",
            borderWidth: 2,
            borderRadius: 8,
          },
        ],
      },

      options: {
        indexAxis: "y",
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              color: "black",
            },
          },
        },
      },
    });
  }

  var nomesRankingAndar = [];
  var dadosRakingAndar = [];
  function buscarGraficoAndar() {
    fetch(`/ranking/rankingAndar`)
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(resposta);
            for (var i = 0; i < resposta.length; i++) {
              nomesRankingAndar.push(resposta[i].nome);
              dadosRakingAndar.push(resposta[i].andarAlcancado);
            }
            plotarGraficoAndar(dadosRakingAndar, nomesRankingAndar);
          });
        } else {
          console.error("Erro na resposta da api");
        }
      })
      .catch(function (erro) {
        console.log("erro encontrado".erro);
      });
  }
  function plotarGraficoAndar(data, nomes) {
    const ctx = document.getElementById("maiorAndar");

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: nomes,
        datasets: [
          {
            label: "Andar alcançado",
            data: data,
            backgroundColor: "rgba(255, 80, 80, 0.6)",
            borderColor: "rgba(255, 50, 50, 1)",
            borderWidth: 2,
            borderRadius: 8,
          },
        ],
      },

      options: {
        indexAxis: "y",
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              color: "black",
            },
          },
        },
      },
    });
  }

  function jogarNovamente() {
    window.location = "../game.html";
  }
  function sair() {
    window.location = "../menu.html";
  }
</script>
